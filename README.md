# à¸£à¸°à¸šà¸š Pub/Sub to Webhook Service

à¸£à¸°à¸šà¸š Pub/Sub (Publisher/Subscriber) à¹à¸šà¸šà¹€à¸£à¸µà¸¢à¸¥à¹„à¸—à¸¡à¹Œà¸—à¸µà¹ˆà¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¹ˆà¸²à¸™ Webhook à¸à¸£à¹‰à¸­à¸¡à¸à¸²à¸£à¹ƒà¸Šà¹‰ JWT signing à¹€à¸à¸·à¹ˆà¸­à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢ à¹€à¸«à¸¡à¸²à¸°à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸šà¸—à¸±à¸à¸©à¸°à¸™à¸±à¸à¸à¸±à¸’à¸™à¸² Backend

## ğŸ“¦ à¸„à¸¸à¸“à¸ªà¸¡à¸šà¸±à¸•à¸´à¸«à¸¥à¸±à¸
- **REST API 4 Endpoint**:
  - `POST /api/subscribe`: à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™ URL à¹€à¸à¸·à¹ˆà¸­à¸£à¸±à¸š Webhook
  - `POST /api/unsubscribe`: à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸£à¸±à¸š Webhook
  - `POST /api/provide_data`: à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸¥à¸‡à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
  - `POST /api/ask`: à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹à¸¥à¸°à¸ªà¹ˆà¸‡à¹„à¸›à¸¢à¸±à¸‡ Subscriber à¸—à¸¸à¸à¸„à¸™à¸œà¹ˆà¸²à¸™ Webhook
- **à¹à¸„à¸Š**: à¹ƒà¸Šà¹‰ Redis à¸”à¹‰à¸§à¸¢à¸£à¸°à¸¢à¸°à¹€à¸§à¸¥à¸²à¹à¸„à¸Š 1 à¸§à¸´à¸™à¸²à¸—à¸µ
- **à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢**: JWT signing à¸ªà¸³à¸«à¸£à¸±à¸š Webhook à¸‚à¸­à¸‡à¹à¸•à¹ˆà¸¥à¸° Subscriber
- **Webhook Receiver**: à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š JWT à¹à¸¥à¸°à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸š
- **Frontend UI**: à¸­à¸´à¸™à¹€à¸—à¸­à¸£à¹Œà¹€à¸Ÿà¸‹à¸ªà¸³à¸«à¸£à¸±à¸šà¸—à¸”à¸ªà¸­à¸š Endpoint à¹à¸¥à¸°à¸”à¸¹à¸›à¸£à¸°à¸§à¸±à¸•à¸´ Webhook

## ğŸ”§ à¹€à¸—à¸„à¹‚à¸™à¹‚à¸¥à¸¢à¸µà¸—à¸µà¹ˆà¹ƒà¸Šà¹‰
- **Node.js**: à¸ªà¸ à¸²à¸à¹à¸§à¸”à¸¥à¹‰à¸­à¸¡à¸£à¸±à¸™à¹„à¸—à¸¡à¹Œ
- **TypeScript**: à¸ à¸²à¸©à¸²à¹‚à¸›à¸£à¹à¸à¸£à¸¡à¸«à¸¥à¸±à¸
- **Fastify**: à¹€à¸Ÿà¸£à¸¡à¹€à¸§à¸´à¸£à¹Œà¸ HTTP Server
- **MySQL / MariaDB**: à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸«à¸¥à¸±à¸
- **Redis**: à¹€à¸‹à¸´à¸£à¹Œà¸Ÿà¹€à¸§à¸­à¸£à¹Œà¹à¸„à¸Š
- **JWT**: à¸à¸²à¸£à¹€à¸‹à¹‡à¸™à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸”à¹‰à¸§à¸¢à¹‚à¸—à¹€à¸„à¹‡à¸™
- **Axios**: à¹„à¸„à¸¥à¹€à¸­à¸™à¸•à¹Œ HTTP à¸ªà¸³à¸«à¸£à¸±à¸š Frontend
- **Tailwind CSS + DaisyUI**: à¸à¸²à¸£à¸­à¸­à¸à¹à¸šà¸š UI

## ğŸ—‚ï¸ à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¹‚à¸›à¸£à¹€à¸ˆà¸à¸•à¹Œ
```
API/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.ts                        # à¸ˆà¸¸à¸”à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¸‚à¸­à¸‡ Fastify
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ config.ts                 # à¸à¸²à¸£à¸à¸³à¸«à¸™à¸”à¸•à¸±à¸§à¹à¸›à¸£à¸ªà¸ à¸²à¸à¹à¸§à¸”à¸¥à¹‰à¸­à¸¡
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â”œâ”€â”€ ask.controller.ts         # à¸•à¸±à¸§à¸„à¸§à¸šà¸„à¸¸à¸¡à¸ªà¸³à¸«à¸£à¸±à¸š Endpoint Ask
â”‚   â”‚   â”œâ”€â”€ provideData.controller.ts # à¸•à¸±à¸§à¸„à¸§à¸šà¸„à¸¸à¸¡à¸ªà¸³à¸«à¸£à¸±à¸š Endpoint Provide Data
â”‚   â”‚   â”œâ”€â”€ subscribe.controller.ts   # à¸•à¸±à¸§à¸„à¸§à¸šà¸„à¸¸à¸¡à¸ªà¸³à¸«à¸£à¸±à¸š Endpoint Subscribe
â”‚   â”‚   â””â”€â”€ unsubscribe.controller.ts # à¸•à¸±à¸§à¸„à¸§à¸šà¸„à¸¸à¸¡à¸ªà¸³à¸«à¸£à¸±à¸š Endpoint Unsubscribe
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ init-db.ts                # à¸ªà¸„à¸£à¸´à¸›à¸•à¹Œà¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™ Schema à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
â”‚   â”‚   â”œâ”€â”€ mysql.ts                  # à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ MySQL à¹à¸šà¸š Connection Pool
â”‚   â”‚   â””â”€â”€ redis.ts                  # à¹„à¸„à¸¥à¹€à¸­à¸™à¸•à¹Œ Redis
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ ask.routes.ts             # à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¸ªà¸³à¸«à¸£à¸±à¸š Endpoint Ask
â”‚   â”‚   â”œâ”€â”€ provideData.routes.ts     # à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¸ªà¸³à¸«à¸£à¸±à¸š Endpoint Provide Data
â”‚   â”‚   â”œâ”€â”€ receiver/
â”‚   â”‚   â”‚   â””â”€â”€ receive.route.ts      # à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¸ªà¸³à¸«à¸£à¸±à¸š Webhook Receiver
â”‚   â”‚   â”œâ”€â”€ subscribe.routes.ts       # à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¸ªà¸³à¸«à¸£à¸±à¸š Endpoint Subscribe
â”‚   â”‚   â””â”€â”€ unsubscribe.routes.ts     # à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¸ªà¸³à¸«à¸£à¸±à¸š Endpoint Unsubscribe
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ provideData.service.ts    # à¸•à¸£à¸£à¸à¸°à¸ªà¸³à¸«à¸£à¸±à¸š Provide Data
â”‚   â”‚   â”œâ”€â”€ subscribe.service.ts      # à¸•à¸£à¸£à¸à¸°à¸ªà¸³à¸«à¸£à¸±à¸š Subscribe
â”‚   â”‚   â”œâ”€â”€ unsubscribe.service.ts    # à¸•à¸£à¸£à¸à¸°à¸ªà¸³à¸«à¸£à¸±à¸š Unsubscribe
â”‚   â”‚   â””â”€â”€ webhook/
â”‚   â”‚       â”œâ”€â”€ data.service.ts       # à¸•à¸£à¸£à¸à¸°à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
â”‚   â”‚       â”œâ”€â”€ redis.service.ts      # à¸•à¸£à¸£à¸à¸°à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£à¹à¸„à¸Š Redis
â”‚   â”‚       â””â”€â”€ webhook.service.ts    # à¸•à¸£à¸£à¸à¸°à¸à¸²à¸£à¸ªà¹ˆà¸‡ Webhook
â”‚   â”œâ”€â”€ test/
â”‚   â”‚   â””â”€â”€ subscribe.controller.test.ts # à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸šà¸ªà¸³à¸«à¸£à¸±à¸š Subscribe Controller
â”‚   â””â”€â”€ webhookServer.ts              # à¹€à¸‹à¸´à¸£à¹Œà¸Ÿà¹€à¸§à¸­à¸£à¹Œà¸ªà¸³à¸«à¸£à¸±à¸š Webhook Receiver
â”œâ”€â”€ .env                              # à¹„à¸Ÿà¸¥à¹Œà¸à¸³à¸«à¸™à¸”à¸•à¸±à¸§à¹à¸›à¸£à¸ªà¸ à¸²à¸à¹à¸§à¸”à¸¥à¹‰à¸­à¸¡
â”œâ”€â”€ .gitignore                        # à¹„à¸Ÿà¸¥à¹Œà¸à¸³à¸«à¸™à¸”à¹„à¸Ÿà¸¥à¹Œ/à¹‚à¸Ÿà¸¥à¹€à¸”à¸­à¸£à¹Œà¸—à¸µà¹ˆ Git à¸ˆà¸°å¿½ç•¥
â”œâ”€â”€ docker-compose.yml                # à¸à¸²à¸£à¸à¸³à¸«à¸™à¸” Docker Services
â”œâ”€â”€ package.json                      # à¸à¸²à¸£à¸à¸³à¸«à¸™à¸” Dependencies à¹à¸¥à¸° Scripts
â””â”€â”€ tsconfig.json                     # à¸à¸²à¸£à¸à¸³à¸«à¸™à¸”à¸„à¹ˆà¸² TypeScript
```

## ğŸ› ï¸ à¸à¸²à¸£à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡à¹à¸¥à¸°à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™
1. **à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ Dependencies à¹à¸¥à¸°à¹€à¸£à¸´à¹ˆà¸¡ Docker**:
   ```bash
   npm install
   docker-compose up -d  # à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² Docker à¸à¸£à¹‰à¸­à¸¡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™
   ```

2. **à¸ªà¸£à¹‰à¸²à¸‡à¹„à¸Ÿà¸¥à¹Œ `.env` (à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡)**:
   ```env
   PORT=3000
   DB_HOST=localhost
   DB_PORT=3306
   DB_USER=root
   DB_PASS=your_password
   DB_NAME=pubsub_db
   REDIS_HOST=localhost
   REDIS_PORT=6379
   ```

3. **à¸ªà¸£à¹‰à¸²à¸‡ Schema à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™**:
   ```bash
   npm run init-db  # à¸£à¸±à¸™à¸ªà¸„à¸£à¸´à¸›à¸•à¹Œà¸ˆà¸²à¸ package.json: "ts-node src/db/init-db.ts"
   ```

4. **à¹€à¸£à¸´à¹ˆà¸¡ Backend Server**:
   ```bash
   npm run dev
   ```

5. **à¹€à¸£à¸´à¹ˆà¸¡ Webhook Receiver Server**:
   ```bash
   npm run dev:webhook
   ```

   ![diagram-export-23-6-2568-11_25_22](https://github.com/user-attachments/assets/c10ca72a-a1f5-45ef-9ea1-d8baa27ca5f8)


## ğŸŒ API Endpoints
### `POST /api/subscribe`
**Request Body**:
```json
{
  "url": "http://localhost:8000/receive"
}
```
**Response**:
```json
{
  "status": "ok",
  "data": {
    "sub_id": 1,
    "secret": "abc"
  }
}
```

### `POST /api/unsubscribe`
**Request Body**:
```json
{
  "sub_id": 1
}
```
**Response**:
```json
{
  "status": "ok"
}
```

### `POST /api/provide_data`
**Request Body**:
```json
{
  "message": "Hello World!"
}
```
**Response**:
```json
{
  "status": "ok"
}
```

### `POST /api/ask`
**Request Body**:
```json
{
  "tx_id": 1
}
```
**Response**:
```json
{
  "status": "ok",
  "data": {
    "message": "Hello World!",
    "timestamp": "2025-04-05T12:34:56Z"
  }
}
```
![Screenshot 2025-06-23 114829](https://github.com/user-attachments/assets/9784f34a-9100-4d43-a63b-97f1a5c344dc)
![à¸«à¸à¸”](https://github.com/user-attachments/assets/bd5751ca-84f5-42a1-883b-285c0fadc1e8)


## ğŸ“¬ Webhook Receiver
- **Endpoint**: `POST /receive`
- **à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™**: à¸£à¸±à¸š Webhook à¸ˆà¸²à¸ Backend, à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š JWT à¹à¸¥à¸°à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡
- **à¸«à¸™à¹‰à¸² Frontend**: à¹€à¸‚à¹‰à¸²à¹„à¸›à¸—à¸µà¹ˆ `/receive` à¹ƒà¸™à¹€à¸šà¸£à¸²à¸§à¹Œà¹€à¸‹à¸­à¸£à¹Œà¹€à¸à¸·à¹ˆà¸­à¸”à¸¹à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸š (à¸­à¸±à¸›à¹€à¸”à¸•à¸—à¸¸à¸ 2 à¸§à¸´à¸™à¸²à¸—à¸µà¸”à¹‰à¸§à¸¢ Polling)

## ğŸ–¥ï¸ Frontend UI
- **à¸«à¸™à¹‰à¸²à¸«à¸¥à¸±à¸**:
  - à¸Ÿà¸­à¸£à¹Œà¸¡à¸ªà¸³à¸«à¸£à¸±à¸šà¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸—à¸±à¹‰à¸‡ 4 Endpoint
  - à¹à¸ªà¸”à¸‡à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¹ƒà¸™à¸£à¸¹à¸›à¹à¸šà¸š JSON
  

5. **à¹€à¸£à¸´à¹ˆà¸¡ Frontend  Server**:
   ```bash
   cd front-end
   npm run dev
   ```
